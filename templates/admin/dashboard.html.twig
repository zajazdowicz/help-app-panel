{% extends 'base.html.twig' %}

{% block title %}Panel administratora{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1>Panel administratora</h1>
    
    <div class="row mt-4">
        <div class="col-md-3 mb-4">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">Użytkownicy</h5>
                    <p class="card-text display-6">{{ stats.users }}</p>
                    <a href="{{ path('admin_users') }}" class="text-white">Zarządzaj →</a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">Domy dziecka</h5>
                    <p class="card-text display-6">{{ stats.orphanages }}</p>
                    <small>Oczekujące: {{ stats.orphanages_pending }}</small><br>
                    <a href="{{ path('admin_orphanages') }}" class="text-white">Zarządzaj →</a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">Marzenia</h5>
                    <p class="card-text display-6">{{ stats.dreams }}</p>
                    <small>Oczekujące: {{ stats.dreams_pending }}</small><br>
                    <a href="{{ path('admin_dreams') }}" class="text-white">Zarządzaj →</a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5 class="card-title">Darowizny</h5>
                    <p class="card-text display-6">{{ stats.fulfillments }}</p>
                    <a href="{{ path('admin_fulfillments') }}" class="text-white">Zarządzaj →</a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="card text-white bg-secondary">
                <div class="card-body">
                    <h5 class="card-title">Kategorie</h5>
                    <p class="card-text display-6">{{ stats.categories|default('?') }}</p>
                    <a href="{{ path('admin_categories') }}" class="text-white">Zarządzaj →</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Szybkie linki</h5>
                    <a href="{{ path('admin_users') }}" class="btn btn-outline-primary me-2">Użytkownicy</a>
                    <a href="{{ path('admin_orphanages') }}" class="btn btn-outline-success me-2">Domy dziecka</a>
                    <a href="{{ path('admin_dreams') }}" class="btn btn-outline-warning me-2">Marzenia</a>
                    <a href="{{ path('admin_fulfillments') }}" class="btn btn-outline-info me-2">Darowizny</a>
                    <a href="{{ path('admin_categories') }}" class="btn btn-outline-secondary me-2">Kategorie</a>
                </div>
            </div>
        </div>
        {# Sekcja darczyńców #}
        {% if dream.fulfillments|length > 0 %}
            <div class="row mt-5">
                <div class="col-12">
                    <h3 class="mb-4">Darczyńcy tego marzenia</h3>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                {% for fulfillment in dream.fulfillments %}
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="card h-100 shadow-sm">
                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    {% if fulfillment.isAnonymous %}
                                                        <i class="bi bi-person-fill"></i> Anonimowy darczyńca
                                                    {% else %}
                                                        <i class="bi bi-person-fill"></i> {{ fulfillment.donorName|default(fulfillment.user ? fulfillment.user.email : 'Darczyńca') }}
                                                    {% endif %}
                                                </h5>
                                                <p class="card-text">
                                                    <strong>Data darowizny:</strong> {{ fulfillment.createdAt|date('d.m.Y H:i') }}<br>
                                                    <strong>Ilość:</strong> {{ fulfillment.quantityFulfilled }} szt.<br>
                                                    {% if fulfillment.childMessage %}
                                                        <strong>Podziękowanie:</strong><br>
                                                        <em>"{{ fulfillment.childMessage }}"</em><br>
                                                    {% endif %}
                                                </p>
                                                {% if fulfillment.childPhotoUrl %}
                                                    <div class="mt-3">
                                                        <img src="{{ fulfillment.childPhotoUrl }}" class="img-fluid rounded" alt="Zdjęcie dziecka z prezentem">
                                                    </div>
                                                {% endif %}
                                                {% if is_granted('ROLE_DIRECTOR') and app.user.orphanage and dream.orphanage.id == app.user.orphanage.id %}
                                                    <div class="mt-3">
                                                        <a href="{{ path('app_dream_fulfillment_edit_thanks', {id: fulfillment.id}) }}" class="btn btn-sm btn-outline-warning">
                                                            <i class="bi bi-pencil"></i> Edytuj podziękowanie
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
