{% extends 'base.html.twig' %}

{% block title %}{{ dream.productTitle }}{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1>{{ dream.productTitle }}</h1>
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Szczeg√≥≈Çy marzenia</h5>
                    <ul class="list-unstyled">
                        <li><strong>Dziecko:</strong> {{ dream.child ? dream.child.firstName : 'Nieznane' }}</li>
                        <li><strong>Status:</strong> {{ dream.status.label() }}</li>
                        <li><strong>Cena produktu:</strong> {{ dream.productPrice }} z≈Ç</li>
                        <li><strong>Kategoria:</strong> {{ dream.category.name }}</li>
                        <li><strong>Potrzebna ilo≈õƒá:</strong> {{ dream.quantityNeeded }}</li>
                        <li><strong>Zakupiono przez afiliacjƒô:</strong> {{ dream.purchasedQuantity }}</li>
                        <li><strong>Pozosta≈Ço:</strong> {{ dream.remainingQuantity }}</li>
                        {% if dream.affiliatePartner %}
                            <li><strong>Partner afiliacyjny:</strong> {{ dream.affiliatePartner }}</li>
                        {% endif %}
                        <li><strong>Pilne:</strong> {% if dream.isUrgent %}Tak{% else %}Nie{% endif %}</li>
                        <li><strong>Dom dziecka:</strong> {{ dream.orphanage.name }}</li>
                    </ul>
                    <p><strong>Opis:</strong> {{ dream.description|default('Brak opisu') }}</p>
                    <p><strong>Link do produktu:</strong> <a href="{{ dream.productUrl }}" target="_blank">{{ dream.productUrl }}</a></p>
                    <p><strong>Data utworzenia:</strong> {{ dream.createdAt|date('d.m.Y H:i') }}</p>
                </div>
            </div>
            
            <div class="mt-3">
                {# Przycisk do linku afiliacyjnego #}
                {% if dream.affiliateUrl %}
                    <a href="{{ path('app_affiliate_go', {id: dream.id}) }}" class="btn btn-success me-2" target="_blank">
                        <span class="me-1">üõí</span> Kup teraz (link afiliacyjny)
                    </a>
                    <p class="text-muted small mt-2">
                        KlikajƒÖc powy≈ºszy przycisk, zostaniesz przekierowany do sklepu partnerskiego. 
                        Zakup w sklepie partnerskim pomo≈ºe spe≈Çniƒá to marzenie.
                    </p>
                {% else %}
                    <button class="btn btn-secondary me-2" disabled>Brak linku afiliacyjnego</button>
                {% endif %}
                
                {# Przyciski dla dyrektora, je≈õli marzenie nale≈ºy do jego domu dziecka #}
                {% if is_granted('ROLE_DIRECTOR') and app.user.orphanage and dream.orphanage.id == app.user.orphanage.id %}
                    <a href="{{ path('director_dream_edit', {id: dream.id}) }}" class="btn btn-primary me-2">
                        <span class="me-1">‚úèÔ∏è</span> Edytuj marzenie
                    </a>
                    <form method="post" action="{{ path('director_dream_delete', {id: dream.id}) }}" style="display:inline;" onsubmit="return confirm('Czy na pewno chcesz usunƒÖƒá to marzenie?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ dream.id) }}">
                        <button type="submit" class="btn btn-danger">
                            <span class="me-1">üóëÔ∏è</span> Usu≈Ñ marzenie
                        </button>
                    </form>
                {% endif %}
                
                {% if is_granted('ROLE_DIRECTOR') and app.user.orphanage and dream.orphanage.id == app.user.orphanage.id %}
                    <a href="{{ path('director_dream_list') }}" class="btn btn-outline-secondary">Powr√≥t do moich marze≈Ñ</a>
                {% else %}
                    <a href="{{ path('app_dream_index') }}" class="btn btn-outline-secondary">Powr√≥t do listy</a>
                {% endif %}
            </div>
            
            {# Link do dodawania nowego marzenia dla dyrektora #}
            {% if is_granted('ROLE_DIRECTOR') %}
                <div class="mt-4">
                    {% if app.user.orphanage and app.user.orphanage.isVerified %}
                        <a href="{{ path('director_dream_new') }}" class="btn btn-outline-primary">
                            <span class="me-1">‚ûï</span> Dodaj nowe marzenie
                        </a>
                    {% else %}
                        <button class="btn btn-outline-secondary" disabled title="{% if not app.user.orphanage %}Brak przypisanego domu dziecka{% elseif not app.user.orphanage.isVerified %}Dom dziecka niezweryfikowany{% endif %}">
                            <span class="me-1">‚ûï</span> Dodaj nowe marzenie ({% if not app.user.orphanage %}brak domu dziecka{% else %}wymaga weryfikacji{% endif %})
                        </button>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
